<%- include('./partials/header') %>
<%- include('./partials/nav') %>

<% if (message && message.length > 0) { %>
  <div class="flash-messages-container animate__animated">
    <div class="flash-message">
      <iconify-icon icon="solar:info-circle-outline" inline class="brand-orange"></iconify-icon><%= message %>
    </div>
  </div>
<% } %>
<div class="container-xxl px-xl-4 p6-0" style="max-width: 500px;">
  <section>
    <div class="row border py-2">
        <div class="col-4 d-flex justify-content-end align-items-center">
            <p class="mb-0">Germany</p>
        </div>
        <div class="col-4 d-flex justify-content-center align-items-center">
            <input class="form-control d-inline-block text-center" style="width: 50px;" type="number" id="home_score" placeholder="0">
            <span class="mx-2">-</span>
            <input class="form-control d-inline-block text-center" style="width: 50px;" type="number" id="away_score" placeholder="0">
        </div>
        <div class="col-4 d-flex justify-content-start align-items-center">
            <p class="mb-0">Scotland</p>
        </div>
    </div>
</section>
<div class="my-3">
  <form method="get" action="/">
    <div class="form-group">
      <select class="form-select" id="round" name="round" onchange="this.form.submit()" style="background:#f6f6f6;border-radius: 6px;border:solid 1px #ededed;">
        <% rounds.forEach(r => { %>
          <option value="<%= r %>" <%= r === selectedRound ? 'selected' : '' %>>Round <%= r %></option>
        <% }); %>
      </select>
    </div>
  </form>
</div>


<form id="predictions-form" method="post" action="/predictions/user-predictions">
  <% fixtures.forEach(fixture => { %>
    <section>
      <div class="row py-2" style="background:#f6f6f6;border-radius: 6px;border:solid 1px #ededed;">
        <div class="col-4 d-flex justify-content-end align-items-center">
          <img src="<%= fixture.home_team.flag %>" style="width:20px;margin-right:8px;">  <p class="mb-0"><%= fixture.home_team.name %></p>
        </div>
        <div class="col-4 d-flex justify-content-center align-items-center">
          <input type="hidden" name="fixture_id_<%= fixture.id %>" value="<%= fixture.id %>">
          <input class="form-control d-inline-block text-center score-input" style="width: 50px;" type="number" name="home_score_<%= fixture.id %>" placeholder="..." value="<%= predictionsMap[fixture.id]?.predicted_home_score || '' %>">
          <span class="mx-2">-</span>
          <input class="form-control d-inline-block text-center score-input" style="width: 50px;" type="number" name="away_score_<%= fixture.id %>" placeholder="..." value="<%= predictionsMap[fixture.id]?.predicted_away_score || '' %>">
        </div>
        <div class="col-4 d-flex justify-content-start align-items-center">
          <p class="mb-0"><%= fixture.away_team.name %></p><img src="<%= fixture.away_team.flag %>" style="width:20px;margin-left:8px;"> 
        </div>
      </div>
    </section>
  <% }); %>

  <% if (!isLocked) { %>
    <div class="mt-3">
      <button type="submit" class="btn btn-primary">Save Predictions</button>
    </div>
  <% } %>
</form>



</div>



<script>
  document.addEventListener('DOMContentLoaded', () => {
    const scoreInputs = document.querySelectorAll('.score-input');

    scoreInputs.forEach((input, index) => {
      input.addEventListener('input', () => {
        if (input.value.length > 0) {
          const nextInput = scoreInputs[index + 1];
          if (nextInput) {
            nextInput.focus();
          }
        }
      });
    });
  });

  // const form = document.getElementById('predictions-form');
  //     form.addEventListener('submit', (event) => {
  //       const confirmed = confirm('Are you sure you want to save your predictions?');
  //       if (!confirmed) {
  //         event.preventDefault();
  //       }
  //     });

      document.addEventListener('DOMContentLoaded', () => {
    const scoreInputs = document.querySelectorAll('.score-input');

    scoreInputs.forEach(input => {
      input.addEventListener('input', () => {
        if (input.value < 0) input.value = 0;
        if (input.value > 30) input.value = 30;
      });
    });
  });
</script>
<%- include('./partials/footer') %>
