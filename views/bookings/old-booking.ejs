<%- include('../partials/header') %>
<%- include('../partials/nav') %>

<h1>Create a New Booking</h1>
    <form action="/bookings/add-booking" method="POST">
        <label for="userId">User:</label>
        <select id="userId" name="userId" required>
            <% users.forEach(user => { %>
                <option value="<%= user.id %>"><%= user.name %> (<%= user.email %>)</option>
            <% }); %>
        </select>
        
        <label for="serviceId">Service:</label>
        <select id="serviceId" name="serviceId" required onchange="updateAddOns()">
            <% services.forEach(service => { %>
                <option value="<%= service.id %>"><%= service.name %> - $<%= service.price %></option>
            <% }); %>
        </select>

        <label for="booking_date">Date:</label>
        <input type="date" id="booking_date" name="booking_date" required>

        <label for="start_time">Start Time:</label>
        <input type="time" id="start_time" name="start_time" required>

        <label for="end_time">End Time:</label>
        <input type="time" id="end_time" name="end_time" required>

        <h3>Add-Ons:</h3>
        <div id="addOnsContainer">
            <!-- Add-ons will be loaded here based on the selected service -->
        </div>

        <input type="hidden" name="tenantId" value="1"> <!-- Assuming tenantId is known and static for this form -->

        <button type="submit">Submit Booking</button>
    </form>

    <script>
        function updateAddOns() {
            const serviceId = document.getElementById('serviceId').value;
            fetch(`../services/${serviceId}/add-ons`) // Adjust the endpoint as necessary
                .then(response => response.json())
                .then(addOns => {
                    const container = document.getElementById('addOnsContainer');
                    container.innerHTML = ''; // Clear existing add-ons
                    addOns.forEach(addOn => {
                        // Assuming each add-on object has id, name, and price properties
                        const div = document.createElement('div');
                        div.innerHTML = `
                            <input type="checkbox" id="addOn${addOn.id}" name="addOns[${addOn.id}][add_on_id]" value="${addOn.id}" data-price="${addOn.price}">
                            <label for="addOn${addOn.id}">${addOn.name} - $${addOn.price}</label>
                            <input type="hidden" name="addOns[${addOn.id}][price]" value="${addOn.price}">
                            <input type="number" name="addOns[${addOn.id}][quantity]" min="1" value="1" style="width: 50px;">
                        `;
                        container.appendChild(div);
                    });
                })
                .catch(error => {
                    console.error('Error fetching add-ons:', error);
                });
        }
        </script>
<%- include('../partials/footer') %>